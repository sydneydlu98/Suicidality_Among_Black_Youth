---
title: "Capstone"
author: "Dingxin Lu"
date: '2022-05-11'
output: html_document
---

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(gtsummary)
library(boot)

data <- read.csv("yrbs2019.csv")
```

```{r}
# subsetting black race
black_data <- data %>%
  filter(Q5 == "C")
#summary(black_data)

# outcome variables
out <- black_data %>%
  select(Q26,Q27, Q28, Q29)
#tbl_summary(out)

# recoding Q28
black_data$Q28 <- case_when(black_data$Q28 == '0 times' ~ '0 times',
                       black_data$Q28 == '1 time' ~ '1 or more time',
                       black_data$Q28 == '2 or 3 times' ~ '1 or more time',
                       black_data$Q28 == '4 or 5 times' ~ '1 or more time',
                       black_data$Q28 == '6 or more times' ~ '1 or more time',
                       black_data$Q28 == 'Missing' ~ 'Missing')


out <- black_data %>%
  select(Q26,Q27, Q28, Q29)

out_renamed <- rename(out,
                    "Suicidal ideation"= "Q26",
                    "Suicide planning"= "Q27",
                    "Suicide attempts" = "Q28",
                    "Severe Suicide attempts" = "Q29")

tbl_summary(out_renamed)
#tbl_summary(black_data)
```

```{r, warning=FALSE}
QN_data <- black_data %>%
  select(QN8:QN99)

cor.data_26 <- QN_data %>%
  select(-QN27, -QN28, -QN29, -QN65, -QN66)

# Q26 — suicidal ideation
names_26 <- colnames(cor.data_26[1:87])
p_value <- c()
for (i in 1:87){
    a <- paste("cor.data_26$",names_26[i], sep = "")
    e <- eval(parse(text = a))
    p_value[i] <- chisq.test(e, cor.data_26$QN26)$p.val
}

result_Q26_temp <- data.frame(names_26, signi = p_value <= 0.05)
result_Q26 <- result_Q26_temp[result_Q26_temp$signi == TRUE, ]
result_Q26$names_26
```


```{r}
# Q27 — suicide planning
cor.data_27 <- QN_data %>%
  select(-QN26, -QN28, -QN29, -QN65, -QN66)

# Q26 — suicidal ideation
names_27 <- colnames(cor.data_27[1:87])
p_value <- c()
for (i in 1:87){
    a <- paste("cor.data_27$",names_27[i], sep = "")
    e <- eval(parse(text = a))
    p_value[i] <- chisq.test(e, cor.data_27$QN27)$p.val
}

result_Q27_temp <- data.frame(names_27, signi = p_value <= 0.05)
result_Q27 <- result_Q27_temp[result_Q27_temp$signi == TRUE, ]
result_Q27$names_27
```

```{r}
# Q28 — suicide attempts (dichotomized)

```

```{r}
# Q29 — severe suicide attempts

```

