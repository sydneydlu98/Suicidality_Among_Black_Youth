---
title: "Capstone"
author: "Dingxin Lu"
date: '2022-05-11'
output: 
  html_document:
   df_print: paged
   toc: true 
   toc_depth: 2  
   number_sections: false
   toc_float:
     collapsed: true
     smooth_scroll: true
---

# read in data

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(gtsummary)
library(boot)
library(table1)
library(survey)
library(broom)
library(MASS)
library(jtools)

data <- read.csv("yrbs2019.csv")
```

# subset black data

```{r}
# subsetting black
black_data <- data %>%
  filter(Q5 == "C") %>%
  mutate(QN28 = replace(QN28, which(QN26 == 2 & QN27 == 2), 2)) %>%
  mutate(QN29 = replace(QN29, which(QN26 == 2 & QN27 == 2), 2)) %>%
  mutate(QN29 = replace(QN29, which(QN28 == 2), 2)) %>%
  mutate(QN28 = replace(QN28, which(QN29 == 1), 1)) %>%
  mutate(QN27 = replace(QN27, which(QN26 == 2), 2)) %>%
  mutate(QN28 = replace(QN28, which(QN26 == 2), 2)) %>%
  mutate(QN29 = replace(QN29, which(QN26 == 2), 2)) %>%
  mutate(QN26 = replace(QN26, which(QN27 == 1), 1)) %>%
  mutate(QN26 = replace(QN26, which(QN28 == 1), 1)) %>%
  mutate(QN26 = replace(QN26, which(QN29 == 1), 1)) %>%
  filter(QN26 != 'NA' | QN27 != 'NA' | QN28 != 'NA' | QN29 != 'NA') 
```

# Statistical analysis

```{r}
# make the independent variable 0 or 1
black_data$QN8 = black_data$QN8 - 1
black_data$QN9 = black_data$QN9 - 1
black_data$QN10 = black_data$QN10 - 1
black_data$QN11 = black_data$QN11 - 1
black_data$QN12 = black_data$QN12 - 1
black_data$QN13 = black_data$QN13 - 1
black_data$QN14 = black_data$QN14 - 1
black_data$QN15 = black_data$QN15 - 1
black_data$QN16 = black_data$QN16 - 1
black_data$QN17 = black_data$QN17 - 1
black_data$QN18 = black_data$QN18 - 1
black_data$QN19 = black_data$QN19 - 1
black_data$QN20 = black_data$QN20 - 1
black_data$QN21 = black_data$QN21 - 1
black_data$QN22 = black_data$QN22 - 1
black_data$QN23 = black_data$QN23 - 1
black_data$QN24 = black_data$QN24 - 1
black_data$QN25 = black_data$QN25 - 1
black_data$QN26 = black_data$QN26 - 1
black_data$QN27 = black_data$QN27 - 1
black_data$QN28 = black_data$QN28 - 1
black_data$QN29 = black_data$QN29 - 1
black_data$QN30 = black_data$QN30 - 1
black_data$QN31 = black_data$QN31 - 1
black_data$QN32 = black_data$QN32 - 1
black_data$QN33 = black_data$QN33 - 1
black_data$QN34 = black_data$QN34 - 1
black_data$QN35 = black_data$QN35 - 1
black_data$QN36 = black_data$QN36 - 1
black_data$QN37 = black_data$QN37 - 1
black_data$QN38 = black_data$QN38 - 1
black_data$QN39 = black_data$QN39 - 1
black_data$QN40 = black_data$QN40 - 1
black_data$QN41 = black_data$QN41 - 1
black_data$QN42 = black_data$QN42 - 1
black_data$QN43 = black_data$QN43 - 1
black_data$QN44 = black_data$QN44 - 1
black_data$QN45 = black_data$QN45 - 1
black_data$QN46 = black_data$QN46 - 1
black_data$QN47 = black_data$QN47 - 1
black_data$QN48 = black_data$QN48 - 1
black_data$QN49 = black_data$QN49 - 1
black_data$QN50 = black_data$QN50 - 1
black_data$QN51 = black_data$QN51 - 1
black_data$QN52 = black_data$QN52 - 1
black_data$QN53 = black_data$QN53 - 1
black_data$QN54 = black_data$QN54 - 1
black_data$QN55 = black_data$QN55 - 1
black_data$QN56 = black_data$QN56 - 1
black_data$QN57 = black_data$QN57 - 1
black_data$QN58 = black_data$QN58 - 1
black_data$QN59 = black_data$QN59 - 1
black_data$QN60 = black_data$QN60 - 1
black_data$QN61 = black_data$QN61 - 1
black_data$QN62 = black_data$QN62 - 1
black_data$QN63 = black_data$QN63 - 1
black_data$QN64 = black_data$QN64 - 1
black_data$QN67 = black_data$QN67 - 1
black_data$QN68 = black_data$QN68 - 1
black_data$QN69 = black_data$QN69 - 1
black_data$QN70 = black_data$QN70 - 1
black_data$QN71 = black_data$QN71 - 1
black_data$QN72 = black_data$QN72 - 1
black_data$QN73 = black_data$QN73 - 1
black_data$QN74 = black_data$QN74 - 1
black_data$QN75 = black_data$QN75 - 1
black_data$QN76 = black_data$QN76 - 1
black_data$QN77 = black_data$QN77 - 1
black_data$QN78 = black_data$QN78 - 1
black_data$QN79 = black_data$QN79 - 1
black_data$QN80 = black_data$QN80 - 1
black_data$QN81 = black_data$QN81 - 1
black_data$QN82 = black_data$QN82 - 1
black_data$QN83 = black_data$QN83 - 1
black_data$QN84 = black_data$QN84 - 1
black_data$QN85 = black_data$QN85 - 1
black_data$QN86 = black_data$QN86 - 1
black_data$QN87 = black_data$QN87 - 1
black_data$QN88 = black_data$QN88 - 1
black_data$QN89 = black_data$QN89 - 1
black_data$QN90 = black_data$QN90 - 1
black_data$QN91 = black_data$QN91 - 1
black_data$QN92 = black_data$QN92 - 1
black_data$QN93 = black_data$QN93 - 1
black_data$QN94 = black_data$QN94 - 1
black_data$QN95 = black_data$QN95 - 1
black_data$QN96 = black_data$QN96 - 1
black_data$QN97 = black_data$QN97 - 1
black_data$QN98 = black_data$QN98 - 1
black_data$QN99 = black_data$QN99 - 1
```

```{r}
# weighted design data
yrbsdes <- svydesign(id=~PSU, 
                     weight=~WEIGHT, 
                     strata=~STRATUM, 
                     data=black_data, 
                     nest=TRUE)
```

# QN26

```{r}
part1 <- c()
for (i in 1:18){
      part1[i] <- summary(svyglm(reformulate(paste0('factor(QN', i+7, ')'), response = 'factor(QN26)'), design = yrbsdes, family = quasibinomial()))$coef[-1, "Pr(>|t|)"]
      df1 <- data.frame(value = part1) %>% na.omit()
}

part2 <- c()
for (i in 23:57){
      part2[i] <- summary(svyglm(reformulate(paste0('factor(QN', i+7, ')'), response = 'factor(QN26)'), design = yrbsdes, family = quasibinomial()))$coef[-1, "Pr(>|t|)"]
      df2 <- data.frame(value = part2) %>% na.omit()
}

part3 <- c()
for (i in 60:92){
      part3[i] <- summary(svyglm(reformulate(paste0('factor(QN', i+7, ')'), response = 'factor(QN26)'), design = yrbsdes, family = quasibinomial()))$coef[-1, "Pr(>|t|)"]
      df3 <- data.frame(value = part3) %>% na.omit()
}

df_26 <- data.frame(variable = c(8:25, 30:64, 67:99), value = rbind(df1, df2, df3))
df_26 %>%
  arrange(value)
```

```{r}
summary(svyglm(QN26 ~ QN25+QN24+QN23+QN41+QN49, data = black_data, design = yrbsdes, family = quasibinomial()))

#QN25: Felt sad or hopeless (Sad or hopeless)
#QN24: Were electronically bullied (Electronic bullying)
#QN23: Were bullied on school property (Bullying at school)
#QN41: Current alcohol use; Dependence: Required by QN44
#QN49: Ever took prescription pain medicine without a doctor's prescription or differently than how a doctor told them to use it (Ever prescription pain medicine use)
```

# QN27

```{r}
part1 <- c()
for (i in 1:18){
      part1[i] <- summary(svyglm(reformulate(paste0('factor(QN', i+7, ')'), response = 'factor(QN27)'), design = yrbsdes, family = quasibinomial()))$coef[-1, "Pr(>|t|)"]
      df1 <- data.frame(value = part1) %>% na.omit()
}

part2 <- c()
for (i in 23:57){
      part2[i] <- summary(svyglm(reformulate(paste0('factor(QN', i+7, ')'), response = 'factor(QN27)'), design = yrbsdes, family = quasibinomial()))$coef[-1, "Pr(>|t|)"]
      df2 <- data.frame(value = part2) %>% na.omit()
}

part3 <- c()
for (i in 60:92){
      part3[i] <- summary(svyglm(reformulate(paste0('factor(QN', i+7, ')'), response = 'factor(QN27)'), design = yrbsdes, family = quasibinomial()))$coef[-1, "Pr(>|t|)"]
      df3 <- data.frame(value = part3) %>% na.omit()
}

df_27 <- data.frame(variable = c(8:25, 30:64, 67:99), value = rbind(df1, df2, df3))
df_27 %>%
  arrange(value)
```

```{r}
summary(svyglm(QN27 ~ QN25+QN23+QN24, data = black_data, design = yrbsdes, family = quasibinomial()))

#QN25: Felt sad or hopeless (Sad or hopeless)
#QN23: Were bullied on school property (Bullying at school)
#QN24: Were electronically bullied (Electronic bullying)
```

# QN28

```{r}
part1 <- c()
for (i in 1:18){
      part1[i] <- summary(svyglm(reformulate(paste0('factor(QN', i+7, ')'), response = 'factor(QN28)'), design = yrbsdes, family = quasibinomial()))$coef[-1, "Pr(>|t|)"]
      df1 <- data.frame(value = part1) %>% na.omit()
}

part2 <- c()
for (i in 23:57){
      part2[i] <- summary(svyglm(reformulate(paste0('factor(QN', i+7, ')'), response = 'factor(QN28)'), design = yrbsdes, family = quasibinomial()))$coef[-1, "Pr(>|t|)"]
      df2 <- data.frame(value = part2) %>% na.omit()
}

part3 <- c()
for (i in 60:92){
      part3[i] <- summary(svyglm(reformulate(paste0('factor(QN', i+7, ')'), response = 'factor(QN28)'), design = yrbsdes, family = quasibinomial()))$coef[-1, "Pr(>|t|)"]
      df3 <- data.frame(value = part3) %>% na.omit()
}

df_28 <- data.frame(variable = c(8:25, 30:64, 67:99), value = rbind(df1, df2, df3))
df_28 %>%
  arrange(value)
```

```{r}
summary(svyglm(QN28 ~ QN23+QN25+QN49, data = black_data, design = yrbsdes, family = quasibinomial()))

#QN23: Were bullied on school property (Bullying at school)
#QN25: Felt sad or hopeless (Sad or hopeless)
#QN49: Ever took prescription pain medicine without a doctor's prescription or differently than how a doctor told them to use it (Ever prescription pain medicine use )
```


# QN29

```{r}
part1 <- c()
for (i in 1:18){
      part1[i] <- summary(svyglm(reformulate(paste0('factor(QN', i+7, ')'), response = 'factor(QN29)'), design = yrbsdes, family = quasibinomial()))$coef[-1, "Pr(>|t|)"]
      df1 <- data.frame(value = part1) %>% na.omit()
}

part2 <- c()
for (i in 23:57){
      part2[i] <- summary(svyglm(reformulate(paste0('factor(QN', i+7, ')'), response = 'factor(QN29)'), design = yrbsdes, family = quasibinomial()))$coef[-1, "Pr(>|t|)"]
      df2 <- data.frame(value = part2) %>% na.omit()
}

part3 <- c()
for (i in 60:92){
      part3[i] <- summary(svyglm(reformulate(paste0('factor(QN', i+7, ')'), response = 'factor(QN29)'), design = yrbsdes, family = quasibinomial()))$coef[-1, "Pr(>|t|)"]
      df3 <- data.frame(value = part3) %>% na.omit()
}

df_29 <- data.frame(variable = c(8:25, 30:64, 67:99), value = rbind(df1, df2, df3))
df_29 %>%
  arrange(value)
```

```{r}
summary(svyglm(QN29 ~ QN69+QN50+QN52, data = black_data, design = yrbsdes, family = quasibinomial()))

#QN69: Did not drink fruit juice (Fruit juice drinking)
#QN50: Ever used cocaine 
#QN52: Ever heroin use
#**QN53: Ever used methamphetamines 
```