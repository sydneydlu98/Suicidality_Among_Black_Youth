---
title: "Capstone"
author: "Dingxin Lu"
date: '2022-05-11'
output: html_document
---

```{r, warning=FALSE, message=FALSE}
library(dplyr)
library(gtsummary)
library(boot)
library(table1)
library(survey)

data <- read.csv("yrbs2019.csv")
```

```{r}
# only black
black_only_data <- data %>%
  filter(Q5 == "C")

# mix and black
both <- data %>%
  filter(grepl("C", data$Q5, fixed=TRUE))

# only mix
mix_race <- both %>%
  filter(Q5 != "C")

# only black = 2279
nrow(black_only_data)
# mix and black = 2797
nrow(both)
# only mix = 488
nrow(mix_race)
```

```{r}
# subsetting black
black_data <- data %>%
  filter(Q5 == "C") %>%
  filter(Q26 != "Missing" | Q27 != "Missing" | Q28 != "Missing" | Q29 != "Missing") %>%
  mutate(QN28 = replace(QN28, which(QN26 == 2 & QN27 == 2), 2)) %>%
  mutate(QN29 = replace(QN29, which(QN26 == 2 & QN27 == 2), 2)) %>%
  mutate(QN29 = replace(QN29, which(QN28 == 2), 2)) %>%
  mutate(QN28 = replace(QN28, which(QN29 == 1), 1)) %>%
  mutate(QN27 = replace(QN27, which(QN26 == 2), 2)) %>%
  mutate(QN28 = replace(QN28, which(QN26 == 2), 2)) %>%
  mutate(QN29 = replace(QN29, which(QN26 == 2), 2)) %>%
  mutate(QN26 = replace(QN26, which(QN27 == 1), 1)) %>%
  mutate(QN26 = replace(QN26, which(QN28 == 1), 1)) %>%
  mutate(QN26 = replace(QN26, which(QN29 == 1), 1))
```

```{r}
# recoding Q28
black_data$Q28 <- case_when(black_data$Q28 == '0 times' ~ 'No',
                            black_data$Q28 == '1 time' ~ 'Yes',
                            black_data$Q28 == '2 or 3 times' ~ 'Yes',
                            black_data$Q28 == '4 or 5 times' ~ 'Yes',
                            black_data$Q28 == '6 or more times' ~ 'Yes',
                            black_data$Q28 == 'Missing' ~ 'Missing')

black_data$Q29 <- case_when(black_data$Q29 == 'Did not attempt suicide' ~ 'No',
                            black_data$Q29 == 'No' ~ 'No',
                            black_data$Q29 == 'Yes' ~ 'Yes',
                            black_data$Q29 == 'Missing' ~ 'Missing')


out <- black_data %>%
  select(Q26, Q27, Q28, Q29) %>%
  mutate(Q28 = replace(Q28, which(Q26 == "No" & Q27 == "No"), "No")) %>%
  mutate(Q29 = replace(Q29, which(Q26 == "No" & Q27 == "No"), "No")) %>%
  mutate(Q29 = replace(Q29, which(Q28 == "No"), "No")) %>%
  mutate(Q28 = replace(Q28, which(Q29 == "Yes"), "Yes")) %>%
  mutate(Q27 = replace(Q27, which(Q26 == "No"), "No"))  %>%
  mutate(Q28 = replace(Q28, which(Q26 == "No"), "No"))  %>%
  mutate(Q29 = replace(Q29, which(Q26 == "No"), "No")) %>%
  mutate(Q26 = replace(Q26, which(Q27 == "Yes"), "Yes")) %>%
  mutate(Q26 = replace(Q26, which(Q28 == "Yes"), "Yes")) %>%
  mutate(Q26 = replace(Q26, which(Q29 == "Yes"), "Yes"))
  

out_renamed <- rename(out,
                      "Suicidal ideation"= "Q26",
                      "Suicide planning"= "Q27",
                      "Suicide attempts" = "Q28",
                      "Severe Suicide attempts" = "Q29")

tbl_summary(out_renamed)

Q_4_var <- out %>%
  group_by(Q26, Q27, Q28, Q29) %>%
  summarise(n = n())

Q_4_var
```

```{r}
# table1: demographic
black_data1 <- black_data %>%
  select(1:4, 6:7, 69:70) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 
  
black_data1
```

```{r}
# table2: safety
black_data2 <- black_data %>%
  select(8:11) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data2
```

```{r}
# table3: violence-related behaviors
black_data3 <- black_data %>%
  select(12:22) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data3
```


```{r}
# table4: bullying
black_data4 <- black_data %>%
  select(23:24) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data4
```

```{r}
# table5: sad feelings and attempted suicide
black_data5 <- black_data %>%
  select(25:29) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data5
```

```{r}
# table6: cigarette smoking and tobacco products
black_data6 <- black_data %>%
  select(30:33, 37:39) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data6
```

```{r}
# table7: electronic vapor products
black_data7 <- black_data %>%
  select(34:36) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data7
```


```{r}
# table8: drinking alcohol
black_data8 <- black_data %>%
  select(40:44) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data8
```

```{r}
# table9: marijuana use
black_data9 <- black_data %>%
  select(45:48) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data9
```

```{r}
# table10: use of drugs
black_data10 <- black_data %>%
  select(49:59) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data10
```

```{r}
#table11: sexual activity
black_data11 <- black_data %>%
  select(60:68) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data11
```

```{r}
# table12: food & drink in past 7 days
black_data12 <- black_data %>%
  select(71:82) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data12
```

```{r}
# table13: physical activity
black_data13 <- black_data %>%
  select(83:89) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data13
```

```{r}
# table14: health related topics
black_data14 <- black_data %>%
  select(90:99) %>%
  tbl_summary(statistic = all_continuous() ~ "{mean}") %>% 
  add_n() %>%
  modify_header(label ~ "**Predictors**") %>%
  bold_labels() 

black_data14
```

```{r}
black_data$QN26 = black_data$QN26 - 1
black_data$QN27 = black_data$QN27 - 1
black_data$QN28 = black_data$QN28 - 1
black_data$QN29 = black_data$QN29 - 1
```

```{r}
yrbsdes <- svydesign(id=~PSU, 
                     weight=~WEIGHT, 
                     strata=~STRATUM, 
                     data=black_data, 
                     nest=TRUE)

# QN26 — suicidal ideation
QN26.1 <-
  svyglm(
    QN26 ~ QN8 + QN9 + QN10 + QN11 + QN12 + QN13 + QN14 + QN15 + QN16 + QN17 + QN18 + QN19 + QN20 +
      QN21 + QN22 + QN23 + QN24 + QN25 +QN30,
    yrbsdes,
    family = quasibinomial()
  )
summary(QN26.1)

QN26.2 <-
  svyglm(
    QN26 ~ QN31 + QN32 + QN33 + QN34 + QN35 + QN36 + QN37 + QN38 + QN39 + QN40 + QN41 + QN42 + QN43 + QN44 + QN45 + QN46 + QN47 + QN48 + QN49+ QN50 + QN51 + QN52,
    yrbsdes,
    family = quasibinomial()
  )
summary(QN26.2)
```


```{r}
# QN27 — suicide planning
QN27 <-
  svyglm(
    QN27 ~ QN8 + QN9 + QN10 + QN11 + QN12 + QN13 + QN14 + QN15 + QN16 + QN17 +
      QN18 + QN19 + QN20 + QN21 + QN22 + QN23 + QN24 + QN25
    + QN30 + QN31 + QN32 + QN33 + QN34 + QN35 + QN36 + QN37 +
      QN38 + QN39 + QN40 + QN41 + QN42 + QN43 + QN44 + QN45 + QN46 + QN47 + QN48 + QN49
    + QN50 + QN51 + QN52 + QN53 + QN54 + QN55 + QN56 + QN57 +
      QN58 + QN59 + QN60 + QN61 + QN62 + QN63 + QN64 + QN67 + QN68 + QN69
    + QN70 + QN71 + QN72 + QN73 + QN74 + QN75 + QN76 + QN77 +
      QN78 + QN79 + QN80 + QN81 + QN82 + QN83 + QN84 + QN85 + QN86 + QN87 + QN88 + QN89
    + QN90 + QN91 + QN92 + QN93 + QN94 + QN95 + QN96 + QN97 + QN98 + QN99,
    yrbsdes,
    family = quasibinomial()
  )

summary(QN27)
```

```{r}
# QN28 — suicide attempts (dichotomized)
QN28 <-
  svyglm(
    QN28 ~ QN8 + QN9 + QN10 + QN11 + QN12 + QN13 + QN14 + QN15 + QN16 + QN17 +
      QN18 + QN19 + QN20 + QN21 + QN22 + QN23 + QN24 + QN25
    + QN30 + QN31 + QN32 + QN33 + QN34 + QN35 + QN36 + QN37 +
      QN38 + QN39 + QN40 + QN41 + QN42 + QN43 + QN44 + QN45 + QN46 + QN47 + QN48 +
      QN49
    + QN50 + QN51 + QN52 + QN53 + QN54 + QN55 + QN56 + QN57 +
      QN58 + QN59 + QN60 + QN61 + QN62 + QN63 + QN64 + QN67 + QN68 + QN69
    + QN70 + QN71 + QN72 + QN73 + QN74 + QN75 + QN76 + QN77 +
      QN78 + QN79 + QN80 + QN81 + QN82 + QN83 + QN84 + QN85 + QN86 + QN87 + QN88 +
      QN89
    + QN90 + QN91 + QN92 + QN93 + QN94 + QN95 + QN96 + QN97 +
      QN98 + QN99,
    yrbsdes,
    family = quasibinomial()
  )

summary(QN28)
```

```{r}
# QN29 — severe suicide attempts
QN29 <-
  svyglm(
    QN29 ~ QN8 + QN9 + QN10 + QN11 + QN12 + QN13 + QN14 + QN15 + QN16 + QN17 +
      QN18 + QN19 + QN20 + QN21 + QN22 + QN23 + QN24 + QN25
    + QN30 + QN31 + QN32 + QN33 + QN34 + QN35 + QN36 + QN37 +
      QN38 + QN39 + QN40 + QN41 + QN42 + QN43 + QN44 + QN45 + QN46 + QN47 + QN48 +
      QN49
    + QN50 + QN51 + QN52 + QN53 + QN54 + QN55 + QN56 + QN57 +
      QN58 + QN59 + QN60 + QN61 + QN62 + QN63 + QN64 + QN67 + QN68 + QN69
    + QN70 + QN71 + QN72 + QN73 + QN74 + QN75 + QN76 + QN77 +
      QN78 + QN79 + QN80 + QN81 + QN82 + QN83 + QN84 + QN85 + QN86 + QN87 + QN88 +
      QN89
    + QN90 + QN91 + QN92 + QN93 + QN94 + QN95 + QN96 + QN97 +
      QN98 + QN99,
    yrbsdes,
    family = quasibinomial()
  )

summary(QN29)
```

